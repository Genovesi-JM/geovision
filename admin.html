<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Admin ‚Äì GeoVision Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050914;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
    }

    /* ============ SIDEBAR ============ */
    .admin-sidebar {
      width: 260px;
      min-height: 100vh;
      background: linear-gradient(180deg, #0f172a 0%, #020617 100%);
      border-right: 1px solid rgba(148, 163, 184, 0.15);
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .admin-sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar-brand {
      padding: 1.2rem 1rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.15);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #22c55e, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #020617;
    }

    .sidebar-brand-text {
      display: flex;
      flex-direction: column;
    }

    .sidebar-brand-name {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.12em;
    }

    .sidebar-brand-sub {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .sidebar-nav {
      flex: 1;
      padding: 1rem 0;
      overflow-y: auto;
    }

    .sidebar-section {
      margin-bottom: 1.5rem;
    }

    .sidebar-section-title {
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #6b7280;
      padding: 0 1rem;
      margin-bottom: 0.5rem;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.65rem 1rem;
      color: #9ca3af;
      text-decoration: none;
      font-size: 0.85rem;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .sidebar-link:hover {
      background: rgba(56, 189, 248, 0.08);
      color: #e5e7eb;
    }

    .sidebar-link.active {
      background: rgba(56, 189, 248, 0.12);
      color: #38bdf8;
      border-left-color: #38bdf8;
    }

    .sidebar-link-icon {
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    .sidebar-link-badge {
      margin-left: auto;
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
    }

    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid rgba(148, 163, 184, 0.15);
    }

    .sidebar-user {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
    }

    .sidebar-user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .sidebar-user-info {
      flex: 1;
      min-width: 0;
    }

    .sidebar-user-name {
      font-size: 0.85rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sidebar-user-role {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    /* ============ MAIN CONTENT ============ */
    .admin-main {
      flex: 1;
      margin-left: 260px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ============ TOP BAR ============ */
    .admin-topbar {
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1.5rem;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 1.4rem;
      cursor: pointer;
    }

    .topbar-breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .topbar-breadcrumb span {
      color: #e5e7eb;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .topbar-search {
      position: relative;
    }

    .topbar-search input {
      width: 240px;
      padding: 0.5rem 0.75rem 0.5rem 2.2rem;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: #e5e7eb;
      font-size: 0.85rem;
      outline: none;
    }

    .topbar-search input:focus {
      border-color: #38bdf8;
    }

    .topbar-search::before {
      content: "üîç";
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.8rem;
    }

    .topbar-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(255, 255, 255, 0.03);
      color: #9ca3af;
      font-size: 1.1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .topbar-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: #e5e7eb;
    }

    .topbar-btn .badge {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #ef4444;
      color: white;
      font-size: 0.65rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-logout {
      padding: 0.5rem 1rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ef4444, #f97316);
      color: white;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
    }

    /* ============ CONTENT AREA ============ */
    .admin-content {
      flex: 1;
      padding: 1.5rem;
    }

    /* ============ PAGE HEADER ============ */
    .page-header {
      margin-bottom: 1.5rem;
    }

    .page-eyebrow {
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    .page-subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
      max-width: 600px;
    }

    /* ============ KPI GRID ============ */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .kpi-card {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.15);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(5, 9, 20, 0.95));
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .kpi-card.revenue {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(5, 9, 20, 0.95));
      border-color: rgba(34, 197, 94, 0.3);
    }

    .kpi-card.warning {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(5, 9, 20, 0.95));
      border-color: rgba(251, 191, 36, 0.3);
    }

    .kpi-card.danger {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(5, 9, 20, 0.95));
      border-color: rgba(239, 68, 68, 0.3);
    }

    .kpi-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .kpi-label {
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .kpi-icon {
      font-size: 1.2rem;
    }

    .kpi-value {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .kpi-change {
      font-size: 0.75rem;
      color: #22c55e;
    }

    .kpi-change.negative {
      color: #ef4444;
    }

    /* ============ CARDS ============ */
    .card {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.15);
      background: rgba(15, 23, 42, 0.7);
      margin-bottom: 1.5rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.2rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
    }

    .card-body {
      padding: 1rem 1.2rem;
    }

    /* ============ TABLES ============ */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .data-table th,
    .data-table td {
      padding: 0.75rem 0.5rem;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .data-table th {
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .data-table tr:hover {
      background: rgba(56, 189, 248, 0.05);
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    /* ============ BADGES ============ */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-active {
      background: rgba(34, 197, 94, 0.15);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .badge-trial {
      background: rgba(56, 189, 248, 0.15);
      color: #38bdf8;
      border: 1px solid rgba(56, 189, 248, 0.3);
    }

    .badge-suspended {
      background: rgba(239, 68, 68, 0.15);
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .badge-pending {
      background: rgba(251, 191, 36, 0.15);
      color: #fbbf24;
      border: 1px solid rgba(251, 191, 36, 0.3);
    }

    /* ============ BUTTONS ============ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-sm {
      padding: 0.35rem 0.7rem;
      font-size: 0.75rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #38bdf8);
      color: #020617;
    }

    .btn-primary:hover {
      filter: brightness(1.1);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #e5e7eb;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-danger {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    .btn-danger:hover {
      background: rgba(239, 68, 68, 0.25);
    }

    /* ============ CONTACT BUTTONS ============ */
    .contact-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .contact-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.4rem 0.7rem;
      border-radius: 8px;
      font-size: 0.75rem;
      text-decoration: none;
      transition: all 0.2s;
    }

    .contact-btn.whatsapp {
      background: rgba(37, 211, 102, 0.15);
      color: #25d366;
      border: 1px solid rgba(37, 211, 102, 0.3);
    }

    .contact-btn.whatsapp:hover {
      background: rgba(37, 211, 102, 0.25);
    }

    .contact-btn.email {
      background: rgba(56, 189, 248, 0.15);
      color: #38bdf8;
      border: 1px solid rgba(56, 189, 248, 0.3);
    }

    .contact-btn.email:hover {
      background: rgba(56, 189, 248, 0.25);
    }

    .contact-btn.phone {
      background: rgba(168, 85, 247, 0.15);
      color: #a855f7;
      border: 1px solid rgba(168, 85, 247, 0.3);
    }

    .contact-btn.phone:hover {
      background: rgba(168, 85, 247, 0.25);
    }

    .contact-btn.instagram {
      background: linear-gradient(135deg, rgba(225, 48, 108, 0.15), rgba(131, 58, 180, 0.15));
      color: #e1306c;
      border: 1px solid rgba(225, 48, 108, 0.3);
    }

    .contact-btn.instagram:hover {
      background: linear-gradient(135deg, rgba(225, 48, 108, 0.25), rgba(131, 58, 180, 0.25));
    }

    /* ============ CHARTS AREA ============ */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .chart-container {
      height: 250px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6b7280;
      font-size: 0.85rem;
    }

    /* ============ VIEW PANELS ============ */
    .view-panel {
      display: none;
    }

    .view-panel.active {
      display: block;
    }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 1024px) {
      .admin-sidebar {
        transform: translateX(-100%);
      }

      .admin-sidebar.open {
        transform: translateX(0);
      }

      .admin-main {
        margin-left: 0;
      }

      .btn-menu-toggle {
        display: flex;
      }

      .topbar-search input {
        width: 180px;
      }
    }

    @media (max-width: 640px) {
      .topbar-search {
        display: none;
      }

      .kpi-grid {
        grid-template-columns: 1fr;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ============ QUICK ACTIONS PANEL ============ */
    .quick-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .quick-action {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1rem;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(148, 163, 184, 0.15);
      color: #e5e7eb;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-action:hover {
      background: rgba(56, 189, 248, 0.1);
      border-color: rgba(56, 189, 248, 0.3);
    }

    /* ============ MODALS ============ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      width: min(600px, 95vw);
      max-height: 90vh;
      overflow-y: auto;
      background: #0f172a;
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 1.5rem;
      cursor: pointer;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(148, 163, 184, 0.1);
    }

    /* ============ FORMS ============ */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.85rem;
      color: #d1d5db;
      margin-bottom: 0.35rem;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.65rem 0.85rem;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
    }

    .form-select option {
      background: #0f172a;
      color: #e5e7eb;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 640px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- ============ SIDEBAR ============ -->
  <aside class="admin-sidebar" id="sidebar">
    <div class="sidebar-brand">
      <div class="sidebar-logo">G</div>
      <div class="sidebar-brand-text">
        <div class="sidebar-brand-name">GEOVISION</div>
        <div class="sidebar-brand-sub">Admin Panel</div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <!-- Dashboard -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">Principal</div>
        <a href="#" class="sidebar-link active" data-view="dashboard">
          <span class="sidebar-link-icon">üìä</span>
          Dashboard Global
        </a>
      </div>

      <!-- Gest√£o -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">Gest√£o</div>
        <a href="#" class="sidebar-link" data-view="clients">
          <span class="sidebar-link-icon">üè¢</span>
          Clientes
          <span class="sidebar-link-badge" id="badge-clients">0</span>
        </a>
        <a href="#" class="sidebar-link" data-view="users">
          <span class="sidebar-link-icon">üë•</span>
          Utilizadores
        </a>
        <a href="#" class="sidebar-link" data-view="sites">
          <span class="sidebar-link-icon">üìç</span>
          Sites / Projetos
        </a>
        <a href="#" class="sidebar-link" data-view="datasets">
          <span class="sidebar-link-icon">üóÑÔ∏è</span>
          Datasets
        </a>
        <a href="#" class="sidebar-link" data-view="documents">
          <span class="sidebar-link-icon">üìÑ</span>
          Documentos
        </a>
      </div>

      <!-- Integra√ß√µes -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">Integra√ß√µes</div>
        <a href="#" class="sidebar-link" data-view="integrations">
          <span class="sidebar-link-icon">üîó</span>
          Softwares Externos
        </a>
      </div>

      <!-- Financeiro -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">Financeiro</div>
        <a href="#" class="sidebar-link" data-view="payments">
          <span class="sidebar-link-icon">üí≥</span>
          Pagamentos
          <span class="sidebar-link-badge badge-warning" id="badge-payments">0</span>
        </a>
        <a href="#" class="sidebar-link" data-view="invoices">
          <span class="sidebar-link-icon">üßæ</span>
          Faturas
        </a>
      </div>

      <!-- Sistema -->
      <div class="sidebar-section">
        <div class="sidebar-section-title">Sistema</div>
        <a href="#" class="sidebar-link" data-view="alerts">
          <span class="sidebar-link-icon">üîî</span>
          Alertas
          <span class="sidebar-link-badge" id="badge-alerts">0</span>
        </a>
        <a href="#" class="sidebar-link" data-view="logs">
          <span class="sidebar-link-icon">üìú</span>
          Audit Logs
        </a>
        <a href="#" class="sidebar-link" data-view="settings">
          <span class="sidebar-link-icon">‚öôÔ∏è</span>
          Configura√ß√µes
        </a>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="sidebar-user-avatar" id="user-avatar">A</div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name" id="user-name">Admin</div>
          <div class="sidebar-user-role" id="user-role">Super Admin</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- ============ MAIN CONTENT ============ -->
  <main class="admin-main">
    <!-- Top Bar -->
    <header class="admin-topbar">
      <div class="topbar-left">
        <button class="btn-menu-toggle" id="btn-menu-toggle">‚ò∞</button>
        <div class="topbar-breadcrumb">
          Admin / <span id="breadcrumb-current">Dashboard</span>
        </div>
      </div>
      <div class="topbar-right">
        <div class="topbar-search">
          <input type="text" placeholder="Pesquisar..." id="global-search" />
        </div>
        <button class="topbar-btn" id="btn-notifications" title="Notifica√ß√µes">
          üîî
          <span class="badge" id="notification-count">3</span>
        </button>
        <button class="topbar-btn" id="btn-help" title="Ajuda">‚ùì</button>
        <button class="btn-logout" id="btn-logout">Terminar sess√£o</button>
      </div>
    </header>

    <!-- Content Area -->
    <div class="admin-content">
      
      <!-- ============ DASHBOARD VIEW ============ -->
      <div class="view-panel active" id="view-dashboard">
        <div class="page-header">
          <div class="page-eyebrow">Vis√£o Geral</div>
          <h1 class="page-title">Dashboard Global</h1>
          <p class="page-subtitle">Monitorize todas as opera√ß√µes, clientes e m√©tricas da plataforma GeoVision em tempo real.</p>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
          <button class="quick-action" onclick="showModal('modal-new-client')">
            <span>‚ûï</span> Novo Cliente
          </button>
          <button class="quick-action" onclick="showModal('modal-new-site')">
            <span>üìç</span> Novo Site
          </button>
          <button class="quick-action" onclick="showModal('modal-upload-doc')">
            <span>üì§</span> Upload Documento
          </button>
          <button class="quick-action" onclick="exportReport()">
            <span>üìä</span> Exportar Relat√≥rio
          </button>
        </div>

        <!-- KPI Grid -->
        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Total Clientes</span>
              <span class="kpi-icon">üè¢</span>
            </div>
            <div class="kpi-value" id="kpi-total-clients">0</div>
            <div class="kpi-change">+12% este m√™s</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Sites Ativos</span>
              <span class="kpi-icon">üìç</span>
            </div>
            <div class="kpi-value" id="kpi-total-sites">0</div>
            <div class="kpi-change">+8% este m√™s</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Datasets</span>
              <span class="kpi-icon">üóÑÔ∏è</span>
            </div>
            <div class="kpi-value" id="kpi-total-datasets">0</div>
            <div class="kpi-change">+15% este m√™s</div>
          </div>
          <div class="kpi-card revenue">
            <div class="kpi-header">
              <span class="kpi-label">Receita Mensal</span>
              <span class="kpi-icon">üí∞</span>
            </div>
            <div class="kpi-value" id="kpi-revenue">0 AOA</div>
            <div class="kpi-change">+22% vs m√™s anterior</div>
          </div>
          <div class="kpi-card warning">
            <div class="kpi-header">
              <span class="kpi-label">Pagamentos Pendentes</span>
              <span class="kpi-icon">‚è≥</span>
            </div>
            <div class="kpi-value" id="kpi-pending-payments">0</div>
            <div class="kpi-change negative">Requerem aten√ß√£o</div>
          </div>
          <div class="kpi-card danger">
            <div class="kpi-header">
              <span class="kpi-label">Alertas Cr√≠ticos</span>
              <span class="kpi-icon">üö®</span>
            </div>
            <div class="kpi-value" id="kpi-critical-alerts">0</div>
            <div class="kpi-change negative">A√ß√£o imediata</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Contratos Ativos</span>
              <span class="kpi-icon">üìã</span>
            </div>
            <div class="kpi-value" id="kpi-contracts">0</div>
            <div class="kpi-change">Est√°vel</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Armazenamento</span>
              <span class="kpi-icon">üíæ</span>
            </div>
            <div class="kpi-value" id="kpi-storage">0 GB</div>
            <div class="kpi-change">De 1 TB</div>
          </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Crescimento Mensal</h3>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">6M</button>
                <button class="btn btn-sm btn-secondary">1A</button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart-container" id="chart-growth">
                üìà Gr√°fico de crescimento (implementar Chart.js)
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Receita por Setor</h3>
            </div>
            <div class="card-body">
              <div class="chart-container" id="chart-revenue-sector">
                ü•ß Gr√°fico de receita por setor
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Atividade Recente</h3>
            <div class="card-actions">
              <button class="btn btn-sm btn-secondary">Ver todos</button>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Hora</th>
                  <th>Utilizador</th>
                  <th>A√ß√£o</th>
                  <th>Recurso</th>
                  <th>Detalhes</th>
                </tr>
              </thead>
              <tbody id="activity-table-body">
                <tr>
                  <td>14:32</td>
                  <td>admin@geovision.ao</td>
                  <td><span class="badge badge-active">Login</span></td>
                  <td>Sistema</td>
                  <td>Luanda, Angola</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ CLIENTS VIEW ============ -->
      <div class="view-panel" id="view-clients">
        <div class="page-header">
          <div class="page-eyebrow">Gest√£o de Clientes</div>
          <h1 class="page-title">Clientes</h1>
          <p class="page-subtitle">Gerir contas de clientes, planos e acessos.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-new-client')">
            <span>‚ûï</span> Novo Cliente
          </button>
          <button class="btn btn-secondary">
            <span>üì•</span> Importar
          </button>
          <button class="btn btn-secondary">
            <span>üì§</span> Exportar
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Lista de Clientes</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="">Todos os status</option>
                <option value="active">Ativos</option>
                <option value="trial">Trial</option>
                <option value="suspended">Suspensos</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Empresa</th>
                  <th>Email</th>
                  <th>Plano</th>
                  <th>Status</th>
                  <th>Sites</th>
                  <th>Contacto</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="clients-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ DOCUMENTS VIEW ============ -->
      <div class="view-panel" id="view-documents">
        <div class="page-header">
          <div class="page-eyebrow">Gest√£o de Documentos</div>
          <h1 class="page-title">Documentos</h1>
          <p class="page-subtitle">Upload, organiza√ß√£o e controlo de acesso a documentos de clientes.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-upload-doc')">
            <span>üì§</span> Upload Documento
          </button>
          <button class="btn btn-secondary">
            <span>üîç</span> Pesquisa Avan√ßada
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Documentos Recentes</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="">Todos os tipos</option>
                <option value="report">Relat√≥rios</option>
                <option value="orthomosaic">Ortomosaicos</option>
                <option value="contract">Contratos</option>
                <option value="geotiff">GeoTIFF</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Cliente</th>
                  <th>Site</th>
                  <th>Tipo</th>
                  <th>Tamanho</th>
                  <th>Status</th>
                  <th>Data</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="documents-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ INTEGRATIONS VIEW ============ -->
      <div class="view-panel" id="view-integrations">
        <div class="page-header">
          <div class="page-eyebrow">Integra√ß√µes</div>
          <h1 class="page-title">Softwares Externos</h1>
          <p class="page-subtitle">Gerir conex√µes com DJI Terra, Pix4D, ArcGIS, Procore e outros.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-new-connector')">
            <span>üîó</span> Nova Integra√ß√£o
          </button>
        </div>

        <div class="kpi-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">DJI Terra</span>
              <span class="kpi-icon">üõ∏</span>
            </div>
            <div class="kpi-value">3</div>
            <div class="kpi-change">Conex√µes ativas</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Pix4D</span>
              <span class="kpi-icon">üì∑</span>
            </div>
            <div class="kpi-value">5</div>
            <div class="kpi-change">Conex√µes ativas</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">ArcGIS</span>
              <span class="kpi-icon">üó∫Ô∏è</span>
            </div>
            <div class="kpi-value">2</div>
            <div class="kpi-change">Conex√µes ativas</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Procore</span>
              <span class="kpi-icon">üèóÔ∏è</span>
            </div>
            <div class="kpi-value">1</div>
            <div class="kpi-change">Conex√µes ativas</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Integra√ß√µes Configuradas</h3>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Cliente</th>
                  <th>Software</th>
                  <th>Nome</th>
                  <th>Status</th>
                  <th>√öltima Sync</th>
                  <th>Auto-Sync</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="integrations-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ SETTINGS VIEW ============ -->
      <div class="view-panel" id="view-settings">
        <div class="page-header">
          <div class="page-eyebrow">Sistema</div>
          <h1 class="page-title">Configura√ß√µes</h1>
          <p class="page-subtitle">Configura√ß√µes gerais da plataforma, seguran√ßa e integra√ß√µes.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Contactos GeoVision</h3>
          </div>
          <div class="card-body">
            <div class="contact-buttons" style="margin-bottom: 1rem;">
              <a href="https://wa.me/244923456789" target="_blank" class="contact-btn whatsapp">
                üì± WhatsApp
              </a>
              <a href="mailto:suporte@geovision.ao" class="contact-btn email">
                ‚úâÔ∏è Email
              </a>
              <a href="tel:+244923456789" class="contact-btn phone">
                üìû Ligar
              </a>
              <a href="sms:+244923456789" class="contact-btn phone">
                üí¨ SMS
              </a>
              <a href="https://instagram.com/geovision.ao" target="_blank" class="contact-btn instagram">
                üì∑ Instagram
              </a>
            </div>
            <p style="font-size: 0.85rem; color: #9ca3af;">
              Estes contactos s√£o usados para comunica√ß√£o directa com clientes e suporte.
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Roles e Permiss√µes</h3>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Role</th>
                  <th>Descri√ß√£o</th>
                  <th>Utilizadores</th>
                  <th>N√≠vel</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><span class="badge badge-active">Super Admin</span></td>
                  <td>Acesso total √† plataforma</td>
                  <td>2</td>
                  <td>Interno GeoVision</td>
                </tr>
                <tr>
                  <td><span class="badge badge-trial">Admin</span></td>
                  <td>Fun√ß√µes administrativas</td>
                  <td>3</td>
                  <td>Interno GeoVision</td>
                </tr>
                <tr>
                  <td><span class="badge badge-pending">Manager</span></td>
                  <td>Opera√ß√µes di√°rias</td>
                  <td>5</td>
                  <td>Interno GeoVision</td>
                </tr>
                <tr>
                  <td><span class="badge badge-active">Client Admin</span></td>
                  <td>Admin da organiza√ß√£o cliente</td>
                  <td>15</td>
                  <td>Cliente</td>
                </tr>
                <tr>
                  <td><span class="badge badge-trial">Client Viewer</span></td>
                  <td>Apenas leitura</td>
                  <td>45</td>
                  <td>Cliente</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Placeholder for other views -->
      <div class="view-panel" id="view-users">
        <div class="page-header">
          <div class="page-eyebrow">Gest√£o</div>
          <h1 class="page-title">Utilizadores</h1>
        </div>
        <div class="card"><div class="card-body">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-sites">
        <div class="page-header">
          <div class="page-eyebrow">Gest√£o</div>
          <h1 class="page-title">Sites / Projetos</h1>
          <p class="page-subtitle">Gerir localiza√ß√µes e projetos de clientes.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-new-site')">
            <span>‚ûï</span> Novo Site
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Lista de Sites</h3>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Cliente</th>
                  <th>Prov√≠ncia</th>
                  <th>Setor</th>
                  <th>√Årea</th>
                  <th>Status</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="sites-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="view-panel" id="view-datasets">
        <div class="page-header">
          <div class="page-eyebrow">Gest√£o</div>
          <h1 class="page-title">Datasets</h1>
          <p class="page-subtitle">Dados de drones, sat√©lite e sensores dos projetos.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Lista de Datasets</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="">Todos os tipos</option>
                <option value="drone_imagery">Drone Imagery</option>
                <option value="satellite">Sat√©lite</option>
                <option value="lidar">LiDAR</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Cliente</th>
                  <th>Site</th>
                  <th>Tipo</th>
                  <th>Tamanho</th>
                  <th>Status</th>
                  <th>Data</th>
                  <th>A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="datasets-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="view-panel" id="view-payments">
        <div class="page-header">
          <div class="page-eyebrow">Financeiro</div>
          <h1 class="page-title">Pagamentos</h1>
        </div>
        <div class="card"><div class="card-body">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-invoices">
        <div class="page-header">
          <div class="page-eyebrow">Financeiro</div>
          <h1 class="page-title">Faturas</h1>
        </div>
        <div class="card"><div class="card-body">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-alerts">
        <div class="page-header">
          <div class="page-eyebrow">Sistema</div>
          <h1 class="page-title">Alertas</h1>
        </div>
        <div class="card"><div class="card-body">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-logs">
        <div class="page-header">
          <div class="page-eyebrow">Sistema</div>
          <h1 class="page-title">Audit Logs</h1>
          <p class="page-subtitle">Hist√≥rico de a√ß√µes e altera√ß√µes na plataforma.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Logs de Auditoria</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="">Todas as a√ß√µes</option>
                <option value="company_created">Empresa criada</option>
                <option value="site_created">Site criado</option>
                <option value="document_created">Documento criado</option>
                <option value="login">Login</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Data/Hora</th>
                  <th>Utilizador</th>
                  <th>A√ß√£o</th>
                  <th>Recurso</th>
                  <th>ID</th>
                  <th>IP</th>
                </tr>
              </thead>
              <tbody id="audit-logs-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- ============ MODALS ============ -->
  
  <!-- New Client Modal -->
  <div class="modal-overlay" id="modal-new-client">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Novo Cliente</h2>
        <button class="modal-close" onclick="closeModal('modal-new-client')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-new-client">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Nome da Empresa *</label>
              <input type="text" class="form-input" name="name" required />
            </div>
            <div class="form-group">
              <label class="form-label">NIF</label>
              <input type="text" class="form-input" name="tax_id" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Email *</label>
              <input type="email" class="form-input" name="email" required />
            </div>
            <div class="form-group">
              <label class="form-label">Telefone</label>
              <input type="tel" class="form-input" name="phone" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">WhatsApp</label>
              <input type="tel" class="form-input" name="whatsapp" placeholder="+244..." />
            </div>
            <div class="form-group">
              <label class="form-label">Plano</label>
              <select class="form-select" name="subscription_plan">
                <option value="trial">Trial (14 dias)</option>
                <option value="starter">Starter</option>
                <option value="professional">Professional</option>
                <option value="enterprise">Enterprise</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Setores</label>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="agro" /> Agro & Pecu√°ria</label>
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="mining" /> Minera√ß√£o</label>
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="demining" /> Desminagem</label>
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="construction" /> Constru√ß√£o</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Morada</label>
            <textarea class="form-textarea" name="address" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('modal-new-client')">Cancelar</button>
        <button class="btn btn-primary" onclick="saveNewClient()">Criar Cliente</button>
      </div>
    </div>
  </div>

  <!-- Upload Document Modal -->
  <div class="modal-overlay" id="modal-upload-doc">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Upload Documento</h2>
        <button class="modal-close" onclick="closeModal('modal-upload-doc')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-upload-doc">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Cliente *</label>
              <select class="form-select" name="company_id" required>
                <option value="">Selecionar cliente...</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Site</label>
              <select class="form-select" name="site_id">
                <option value="">Selecionar site...</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Tipo de Documento *</label>
              <select class="form-select" name="document_type" required>
                <option value="report">Relat√≥rio</option>
                <option value="orthomosaic">Ortomosaico</option>
                <option value="contract">Contrato</option>
                <option value="invoice">Fatura</option>
                <option value="geotiff">GeoTIFF</option>
                <option value="point_cloud">Point Cloud (LAS/LAZ)</option>
                <option value="shapefile">Shapefile</option>
                <option value="dxf">DXF</option>
                <option value="other">Outro</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Status</label>
              <select class="form-select" name="status">
                <option value="draft">Rascunho</option>
                <option value="pending_review">Pendente Revis√£o</option>
                <option value="approved">Aprovado</option>
                <option value="official">Oficial</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Nome do Documento *</label>
            <input type="text" class="form-input" name="name" required />
          </div>
          <div class="form-group">
            <label class="form-label">Ficheiro *</label>
            <input type="file" class="form-input" name="file" required 
                   accept=".pdf,.docx,.doc,.tif,.tiff,.las,.laz,.shp,.csv,.dxf,.png,.jpg,.jpeg" />
            <p style="font-size: 0.75rem; color: #6b7280; margin-top: 0.3rem;">
              Formatos: PDF, DOCX, GeoTIFF, LAS/LAZ, SHP, CSV, DXF, Imagens
            </p>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label style="font-size: 0.85rem;">
                <input type="checkbox" name="is_confidential" /> Confidencial
              </label>
            </div>
            <div class="form-group">
              <label style="font-size: 0.85rem;">
                <input type="checkbox" name="is_official" /> Marcar como Oficial
              </label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Descri√ß√£o</label>
            <textarea class="form-textarea" name="description" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('modal-upload-doc')">Cancelar</button>
        <button class="btn btn-primary" onclick="uploadDocument()">Upload</button>
      </div>
    </div>
  </div>

  <script src="assets/js/config.js?v=3"></script>
  <script>
    // ============ VIEW NAVIGATION ============
    const viewLinks = document.querySelectorAll('.sidebar-link[data-view]');
    const viewPanels = document.querySelectorAll('.view-panel');
    const breadcrumb = document.getElementById('breadcrumb-current');

    function switchView(viewId) {
      // Update sidebar
      viewLinks.forEach(link => {
        link.classList.toggle('active', link.dataset.view === viewId);
      });

      // Update panels
      viewPanels.forEach(panel => {
        panel.classList.toggle('active', panel.id === `view-${viewId}`);
      });

      // Update breadcrumb
      const activeLink = document.querySelector(`.sidebar-link[data-view="${viewId}"]`);
      if (activeLink) {
        breadcrumb.textContent = activeLink.textContent.trim();
      }
    }

    viewLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        switchView(link.dataset.view);
      });
    });

    // ============ SIDEBAR TOGGLE ============
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('btn-menu-toggle');

    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      if (window.innerWidth <= 1024) {
        if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
          sidebar.classList.remove('open');
        }
      }
    });

    // ============ MODALS ============
    function showModal(modalId) {
      document.getElementById(modalId).classList.add('open');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('open');
    }

    // Close modal on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('open');
        }
      });
    });

    // ============ API CALLS ============
    const API_BASE = window.GV_CONFIG?.API_BASE || 'http://127.0.0.1:8010';

    async function loadDashboardData() {
      try {
        const response = await fetch(`${API_BASE}/admin/stats`);
        if (response.ok) {
          const stats = await response.json();
          document.getElementById('kpi-total-clients').textContent = stats.total_companies || 0;
          document.getElementById('kpi-total-sites').textContent = stats.total_sites || 0;
          document.getElementById('kpi-total-datasets').textContent = stats.total_datasets || 0;
          document.getElementById('kpi-pending-payments').textContent = stats.payments_pending || 0;
          document.getElementById('badge-clients').textContent = stats.total_companies || 0;
          document.getElementById('badge-payments').textContent = stats.payments_pending || 0;
        }
      } catch (err) {
        console.warn('Could not load admin stats:', err);
      }
    }

    async function loadClients() {
      try {
        const response = await fetch(`${API_BASE}/admin/companies`);
        if (response.ok) {
          const companies = await response.json();
          const tbody = document.getElementById('clients-table-body');
          tbody.innerHTML = companies.map(c => `
            <tr>
              <td><strong>${c.name}</strong></td>
              <td>${c.email}</td>
              <td><span class="badge badge-trial">${c.subscription_plan}</span></td>
              <td><span class="badge badge-${c.status}">${c.status}</span></td>
              <td>${c.current_sites} / ${c.max_sites}</td>
              <td>
                <div class="contact-buttons">
                  ${c.phone ? `<a href="https://wa.me/${c.phone.replace(/[^0-9]/g, '')}" target="_blank" class="contact-btn whatsapp">üì±</a>` : ''}
                  <a href="mailto:${c.email}" class="contact-btn email">‚úâÔ∏è</a>
                </div>
              </td>
              <td>
                <button class="btn btn-sm btn-secondary" onclick="editClient('${c.id}')">Editar</button>
                <button class="btn btn-sm btn-danger" onclick="suspendClient('${c.id}')">Suspender</button>
              </td>
            </tr>
          `).join('');
        }
      } catch (err) {
        console.warn('Could not load clients:', err);
      }
    }

    async function saveNewClient() {
      const form = document.getElementById('form-new-client');
      const formData = new FormData(form);
      
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        tax_id: formData.get('tax_id'),
        address: formData.get('address'),
        subscription_plan: formData.get('subscription_plan'),
        sectors: formData.getAll('sectors'),
      };

      try {
        const response = await fetch(`${API_BASE}/admin/companies`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          closeModal('modal-new-client');
          form.reset();
          loadClients();
          loadDashboardData();
          alert('Cliente criado com sucesso!');
        } else {
          const err = await response.json();
          alert('Erro: ' + (err.detail || 'N√£o foi poss√≠vel criar'));
        }
      } catch (err) {
        alert('Erro de conex√£o: ' + err.message);
      }
    }

    function editClient(clientId) {
      alert('Editar cliente: ' + clientId);
    }

    async function suspendClient(clientId) {
      if (!confirm('Tem certeza que deseja suspender este cliente?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/admin/companies/${clientId}`, {
          method: 'DELETE',
        });
        if (response.ok) {
          loadClients();
          loadDashboardData();
        }
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    function uploadDocument() {
      alert('Upload de documento - implementar com FormData e endpoint de upload');
      closeModal('modal-upload-doc');
    }

    function exportReport() {
      alert('Exportar relat√≥rio - implementar');
    }

    // ============ SITES ============
    async function loadSites() {
      try {
        const response = await fetch(`${API_BASE}/admin/sites`);
        if (response.ok) {
          const sites = await response.json();
          const tbody = document.getElementById('sites-table-body');
          if (tbody) {
            tbody.innerHTML = sites.map(s => `
              <tr>
                <td><strong>${s.name}</strong></td>
                <td>${s.company_id.substring(0, 8)}...</td>
                <td>${s.province || '-'}</td>
                <td>${s.sector || '-'}</td>
                <td>${s.area_hectares ? s.area_hectares.toFixed(1) + ' ha' : '-'}</td>
                <td><span class="badge ${s.is_active ? 'badge-active' : 'badge-suspended'}">${s.is_active ? 'Ativo' : 'Inativo'}</span></td>
                <td>
                  <button class="btn btn-sm btn-secondary" onclick="viewSite('${s.id}')">Ver</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteSite('${s.id}')">Excluir</button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load sites:', err);
      }
    }

    async function deleteSite(siteId) {
      if (!confirm('Tem certeza que deseja excluir este site?')) return;
      try {
        await fetch(`${API_BASE}/admin/sites/${siteId}`, { method: 'DELETE' });
        loadSites();
        loadDashboardData();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    function viewSite(siteId) {
      alert('Ver detalhes do site: ' + siteId);
    }

    // ============ DOCUMENTS ============
    async function loadDocuments() {
      try {
        const response = await fetch(`${API_BASE}/admin/documents`);
        if (response.ok) {
          const docs = await response.json();
          const tbody = document.getElementById('documents-table-body');
          if (tbody) {
            tbody.innerHTML = docs.map(d => `
              <tr>
                <td><strong>${d.name}</strong></td>
                <td>${d.company_id.substring(0, 8)}...</td>
                <td>${d.site_id ? d.site_id.substring(0, 8) + '...' : '-'}</td>
                <td><span class="badge badge-trial">${d.document_type}</span></td>
                <td>${formatBytes(d.file_size_bytes)}</td>
                <td><span class="badge badge-${d.status === 'approved' ? 'active' : d.status === 'draft' ? 'pending' : 'trial'}">${d.status}</span></td>
                <td>${new Date(d.created_at).toLocaleDateString('pt-PT')}</td>
                <td>
                  <button class="btn btn-sm btn-secondary" onclick="downloadDocument('${d.id}')">üì•</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteDocument('${d.id}')">üóëÔ∏è</button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load documents:', err);
      }
    }

    function formatBytes(bytes) {
      if (!bytes || bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    async function deleteDocument(docId) {
      if (!confirm('Tem certeza que deseja excluir este documento?')) return;
      try {
        await fetch(`${API_BASE}/admin/documents/${docId}`, { method: 'DELETE' });
        loadDocuments();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    function downloadDocument(docId) {
      alert('Download do documento: ' + docId);
    }

    // ============ INTEGRATIONS ============
    async function loadIntegrations() {
      try {
        const response = await fetch(`${API_BASE}/admin/integrations`);
        if (response.ok) {
          const integrations = await response.json();
          const tbody = document.getElementById('integrations-table-body');
          if (tbody) {
            tbody.innerHTML = integrations.map(i => `
              <tr>
                <td>${i.company_id.substring(0, 8)}...</td>
                <td><span class="badge badge-trial">${i.connector_type}</span></td>
                <td><strong>${i.name}</strong></td>
                <td><span class="badge ${i.is_active ? 'badge-active' : 'badge-suspended'}">${i.is_active ? 'Ativo' : 'Inativo'}</span></td>
                <td>${i.last_sync_at ? new Date(i.last_sync_at).toLocaleString('pt-PT') : 'Nunca'}</td>
                <td>${i.auto_sync_enabled ? '‚úÖ' : '‚ùå'}</td>
                <td>
                  <button class="btn btn-sm btn-primary" onclick="syncIntegration('${i.id}')">üîÑ Sync</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteIntegration('${i.id}')">üóëÔ∏è</button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load integrations:', err);
      }
    }

    async function syncIntegration(integrationId) {
      try {
        const response = await fetch(`${API_BASE}/admin/integrations/${integrationId}/sync`, { method: 'POST' });
        if (response.ok) {
          alert('Sync iniciado!');
          loadIntegrations();
        }
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    async function deleteIntegration(integrationId) {
      if (!confirm('Tem certeza que deseja excluir esta integra√ß√£o?')) return;
      try {
        await fetch(`${API_BASE}/admin/integrations/${integrationId}`, { method: 'DELETE' });
        loadIntegrations();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    // ============ DATASETS ============
    async function loadDatasets() {
      try {
        const response = await fetch(`${API_BASE}/admin/datasets`);
        if (response.ok) {
          const datasets = await response.json();
          const tbody = document.getElementById('datasets-table-body');
          if (tbody) {
            tbody.innerHTML = datasets.map(d => `
              <tr>
                <td><strong>${d.name}</strong></td>
                <td>${d.company_id.substring(0, 8)}...</td>
                <td>${d.site_id.substring(0, 8)}...</td>
                <td><span class="badge badge-trial">${d.data_type}</span></td>
                <td>${formatBytes(d.size_bytes)}</td>
                <td><span class="badge badge-${d.status === 'processed' ? 'active' : 'pending'}">${d.status}</span></td>
                <td>${new Date(d.created_at).toLocaleDateString('pt-PT')}</td>
                <td>
                  <button class="btn btn-sm btn-danger" onclick="deleteDataset('${d.id}')">üóëÔ∏è</button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load datasets:', err);
      }
    }

    async function deleteDataset(datasetId) {
      if (!confirm('Tem certeza que deseja excluir este dataset?')) return;
      try {
        await fetch(`${API_BASE}/admin/datasets/${datasetId}`, { method: 'DELETE' });
        loadDatasets();
        loadDashboardData();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    // ============ AUDIT LOGS ============
    async function loadAuditLogs() {
      try {
        const response = await fetch(`${API_BASE}/admin/audit-logs`);
        if (response.ok) {
          const logs = await response.json();
          const tbody = document.getElementById('audit-logs-table-body');
          if (tbody) {
            tbody.innerHTML = logs.map(l => `
              <tr>
                <td>${new Date(l.created_at).toLocaleString('pt-PT')}</td>
                <td>${l.user_id || 'Sistema'}</td>
                <td><span class="badge badge-trial">${l.action}</span></td>
                <td>${l.resource_type}</td>
                <td>${l.resource_id ? l.resource_id.substring(0, 8) + '...' : '-'}</td>
                <td>${l.ip_address || '-'}</td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load audit logs:', err);
      }
    }

    // ============ VIEW CHANGE HANDLER ============
    function onViewChange(viewId) {
      switch (viewId) {
        case 'clients':
          loadClients();
          break;
        case 'sites':
          loadSites();
          break;
        case 'documents':
          loadDocuments();
          break;
        case 'integrations':
          loadIntegrations();
          break;
        case 'datasets':
          loadDatasets();
          break;
        case 'logs':
          loadAuditLogs();
          break;
      }
    }

    // Update switchView to call onViewChange
    const originalSwitchView = switchView;
    switchView = function(viewId) {
      originalSwitchView(viewId);
      onViewChange(viewId);
    };

    // ============ LOGOUT ============
    document.getElementById('btn-logout').addEventListener('click', () => {
      localStorage.removeItem('gv_token');
      localStorage.removeItem('gv_role');
      localStorage.removeItem('gv_email');
      window.location.href = 'index.html';
    });

    // ============ INIT ============
    document.addEventListener('DOMContentLoaded', () => {
      loadDashboardData();
      loadClients();

      // Load user info
      const email = localStorage.getItem('gv_email') || 'admin@geovision';
      const role = localStorage.getItem('gv_role') || 'admin';
      document.getElementById('user-name').textContent = email.split('@')[0];
      document.getElementById('user-role').textContent = role === 'admin' ? 'Super Admin' : role;
      document.getElementById('user-avatar').textContent = email.charAt(0).toUpperCase();
    });
  </script>
</body>
</html>
