<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Admin – GeoVision Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="stylesheet" href="assets/css/chatbot.css" />
  <script src="assets/js/config.js?v=5"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050914;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
    }

    /* ============ SIDEBAR ============ */
    .admin-sidebar {
      width: 260px;
      min-height: 100vh;
      background: linear-gradient(180deg, #0f172a 0%, #020617 100%);
      border-right: 1px solid rgba(148, 163, 184, 0.15);
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .admin-sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar-brand {
      padding: 1.2rem 1rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.15);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #22c55e, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #020617;
    }

    .sidebar-brand-text {
      display: flex;
      flex-direction: column;
    }

    .sidebar-brand-name {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.12em;
    }

    .sidebar-brand-sub {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    .sidebar-nav {
      flex: 1;
      padding: 1rem 0;
      overflow-y: auto;
    }

    .sidebar-section {
      margin-bottom: 1.5rem;
    }

    .sidebar-section-title {
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #6b7280;
      padding: 0 1rem;
      margin-bottom: 0.5rem;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.65rem 1rem;
      color: #9ca3af;
      text-decoration: none;
      font-size: 0.85rem;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .sidebar-link:hover {
      background: rgba(56, 189, 248, 0.08);
      color: #e5e7eb;
    }

    .sidebar-link.active {
      background: rgba(56, 189, 248, 0.12);
      color: #38bdf8;
      border-left-color: #38bdf8;
    }

    .sidebar-link-icon {
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    .sidebar-link-badge {
      margin-left: auto;
      font-size: 0.7rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
    }

    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid rgba(148, 163, 184, 0.15);
    }

    .sidebar-user {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
    }

    .sidebar-user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .sidebar-user-info {
      flex: 1;
      min-width: 0;
    }

    .sidebar-user-name {
      font-size: 0.85rem;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sidebar-user-role {
      font-size: 0.7rem;
      color: #9ca3af;
    }

    /* ============ MAIN CONTENT ============ */
    .admin-main {
      flex: 1;
      margin-left: 260px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ============ TOP BAR ============ */
    .admin-topbar {
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1.5rem;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 1.4rem;
      cursor: pointer;
    }

    .topbar-breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .topbar-breadcrumb span {
      color: #e5e7eb;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .lang-toggle { display: flex; gap: 4px; }
    .lang-btn {
      padding: 4px 10px; border-radius: 6px; border: 1px solid rgba(148,163,184,0.25);
      background: transparent; color: #9ca3af; font-size: .78rem; font-weight: 600;
      cursor: pointer; transition: all .2s;
    }
    .lang-btn:hover { background: rgba(255,255,255,0.08); color: #e5e7eb; }
    .lang-btn.active {
      background: linear-gradient(135deg,#22c55e,#38bdf8); color: #fff;
      border-color: transparent;
    }

    .topbar-search {
      position: relative;
    }

    .topbar-search input {
      width: 240px;
      padding: 0.5rem 0.75rem 0.5rem 2.2rem;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(255, 255, 255, 0.05);
      color: #e5e7eb;
      font-size: 0.85rem;
      outline: none;
    }

    .topbar-search input:focus {
      border-color: #38bdf8;
    }

    .topbar-search::before {
      content: "\f002";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.8rem;
    }

    .topbar-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(255, 255, 255, 0.03);
      color: #9ca3af;
      font-size: 1.1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .topbar-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: #e5e7eb;
    }

    .topbar-btn .badge {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #ef4444;
      color: white;
      font-size: 0.65rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-logout {
      padding: 0.5rem 1rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ef4444, #f97316);
      color: white;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
    }

    /* ============ CONTENT AREA ============ */
    .admin-content {
      flex: 1;
      padding: 1.5rem;
    }

    /* ============ PAGE HEADER ============ */
    .page-header {
      margin-bottom: 1.5rem;
    }

    .page-eyebrow {
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }

    .page-subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
      max-width: 600px;
    }

    /* ============ KPI GRID ============ */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .kpi-card {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.15);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(5, 9, 20, 0.95));
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .kpi-card.revenue {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(5, 9, 20, 0.95));
      border-color: rgba(34, 197, 94, 0.3);
    }

    .kpi-card.warning {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(5, 9, 20, 0.95));
      border-color: rgba(251, 191, 36, 0.3);
    }

    .kpi-card.danger {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(5, 9, 20, 0.95));
      border-color: rgba(239, 68, 68, 0.3);
    }

    .kpi-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .kpi-label {
      font-size: 0.75rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .kpi-icon {
      font-size: 1.2rem;
    }

    .kpi-value {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .kpi-change {
      font-size: 0.75rem;
      color: #22c55e;
    }

    .kpi-change.negative {
      color: #ef4444;
    }

    /* ============ CARDS ============ */
    .card {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.15);
      background: rgba(15, 23, 42, 0.7);
      margin-bottom: 1.5rem;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.2rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .card-actions {
      display: flex;
      gap: 0.5rem;
    }

    .card-body {
      padding: 1rem 1.2rem;
    }

    /* ============ TABLES ============ */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .data-table th,
    .data-table td {
      padding: 0.75rem 0.5rem;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .data-table th {
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .data-table tr:hover {
      background: rgba(56, 189, 248, 0.05);
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    /* ============ BADGES ============ */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-active {
      background: rgba(34, 197, 94, 0.15);
      color: #4ade80;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .badge-trial {
      background: rgba(56, 189, 248, 0.15);
      color: #38bdf8;
      border: 1px solid rgba(56, 189, 248, 0.3);
    }

    .badge-suspended {
      background: rgba(239, 68, 68, 0.15);
      color: #f87171;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .badge-pending {
      background: rgba(251, 191, 36, 0.15);
      color: #fbbf24;
      border: 1px solid rgba(251, 191, 36, 0.3);
    }

    /* ============ BUTTONS ============ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-sm {
      padding: 0.35rem 0.7rem;
      font-size: 0.75rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #38bdf8);
      color: #020617;
    }

    .btn-primary:hover {
      filter: brightness(1.1);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #e5e7eb;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-danger {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }

    .btn-danger:hover {
      background: rgba(239, 68, 68, 0.25);
    }

    /* ============ CONTACT BUTTONS ============ */
    .contact-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .contact-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.4rem 0.7rem;
      border-radius: 8px;
      font-size: 0.75rem;
      text-decoration: none;
      transition: all 0.2s;
    }

    .contact-btn.whatsapp {
      background: rgba(37, 211, 102, 0.15);
      color: #25d366;
      border: 1px solid rgba(37, 211, 102, 0.3);
    }

    .contact-btn.whatsapp:hover {
      background: rgba(37, 211, 102, 0.25);
    }

    .contact-btn.email {
      background: rgba(56, 189, 248, 0.15);
      color: #38bdf8;
      border: 1px solid rgba(56, 189, 248, 0.3);
    }

    .contact-btn.email:hover {
      background: rgba(56, 189, 248, 0.25);
    }

    .contact-btn.phone {
      background: rgba(168, 85, 247, 0.15);
      color: #a855f7;
      border: 1px solid rgba(168, 85, 247, 0.3);
    }

    .contact-btn.phone:hover {
      background: rgba(168, 85, 247, 0.25);
    }

    .contact-btn.instagram {
      background: linear-gradient(135deg, rgba(225, 48, 108, 0.15), rgba(131, 58, 180, 0.15));
      color: #e1306c;
      border: 1px solid rgba(225, 48, 108, 0.3);
    }

    .contact-btn.instagram:hover {
      background: linear-gradient(135deg, rgba(225, 48, 108, 0.25), rgba(131, 58, 180, 0.25));
    }

    /* ============ CHARTS AREA ============ */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .chart-container {
      height: 250px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6b7280;
      font-size: 0.85rem;
    }

    /* ============ VIEW PANELS ============ */
    .view-panel {
      display: none;
    }

    .view-panel.active {
      display: block;
    }

    /* ============ RESPONSIVE ============ */
    @media (max-width: 1024px) {
      .admin-sidebar {
        transform: translateX(-100%);
      }

      .admin-sidebar.open {
        transform: translateX(0);
      }

      .admin-main {
        margin-left: 0;
      }

      .btn-menu-toggle {
        display: flex;
      }

      .topbar-search input {
        width: 180px;
      }
    }

    @media (max-width: 640px) {
      .topbar-search {
        display: none;
      }

      .kpi-grid {
        grid-template-columns: 1fr;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ============ QUICK ACTIONS PANEL ============ */
    .quick-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .quick-action {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1rem;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(148, 163, 184, 0.15);
      color: #e5e7eb;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-action:hover {
      background: rgba(56, 189, 248, 0.1);
      border-color: rgba(56, 189, 248, 0.3);
    }

    /* ============ MODALS ============ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      width: min(600px, 95vw);
      max-height: 90vh;
      overflow-y: auto;
      background: #0f172a;
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 16px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 1.5rem;
      cursor: pointer;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(148, 163, 184, 0.1);
    }

    /* ============ FORMS ============ */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      font-size: 0.85rem;
      color: #d1d5db;
      margin-bottom: 0.35rem;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.65rem 0.85rem;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
    }

    .form-select option {
      background: #0f172a;
      color: #e5e7eb;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    @media (max-width: 640px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- ============ SIDEBAR ============ -->
  <aside class="admin-sidebar" id="sidebar">
    <div class="sidebar-brand">
      <div class="sidebar-logo">G</div>
      <div class="sidebar-brand-text">
        <div class="sidebar-brand-name">GEOVISION</div>
        <div class="sidebar-brand-sub" data-i18n="admin.brand">Admin Panel</div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <!-- Dashboard -->
      <div class="sidebar-section">
        <div class="sidebar-section-title" data-i18n="admin.section.main">Principal</div>
        <a href="#" class="sidebar-link active" data-view="dashboard">
          <span class="sidebar-link-icon"><i class="fa-solid fa-chart-column"></i></span>
          <span data-i18n="admin.nav.dashboard">Dashboard Global</span>
        </a>
      </div>

      <!-- Gestão -->
      <div class="sidebar-section">
        <div class="sidebar-section-title" data-i18n="admin.section.management">Gestão</div>
        <a href="#" class="sidebar-link" data-view="clients">
          <span class="sidebar-link-icon"><i class="fa-solid fa-building"></i></span>
          <span data-i18n="admin.nav.clients">Clientes</span>
          <span class="sidebar-link-badge" id="badge-clients">0</span>
        </a>
        <a href="#" class="sidebar-link" data-view="users">
          <span class="sidebar-link-icon"><i class="fa-solid fa-users"></i></span>
          <span data-i18n="admin.nav.users">Utilizadores</span>
        </a>
        <a href="#" class="sidebar-link" data-view="sites">
          <span class="sidebar-link-icon"><i class="fa-solid fa-location-dot"></i></span>
          <span data-i18n="admin.nav.sites">Sites / Projetos</span>
        </a>
        <a href="#" class="sidebar-link" data-view="datasets">
          <span class="sidebar-link-icon"><i class="fa-solid fa-database"></i></span>
          <span data-i18n="admin.nav.datasets">Datasets</span>
        </a>
        <a href="#" class="sidebar-link" data-view="documents">
          <span class="sidebar-link-icon"><i class="fa-solid fa-file-lines"></i></span>
          <span data-i18n="admin.nav.documents">Documentos</span>
        </a>
      </div>

      <!-- Integrações -->
      <div class="sidebar-section">
        <div class="sidebar-section-title" data-i18n="admin.section.integrations">Integrações</div>
        <a href="#" class="sidebar-link" data-view="integrations">
          <span class="sidebar-link-icon"><i class="fa-solid fa-link"></i></span>
          <span data-i18n="admin.nav.software">Softwares Externos</span>
        </a>
      </div>

      <!-- Financeiro -->
      <div class="sidebar-section">
        <div class="sidebar-section-title" data-i18n="admin.section.financial">Financeiro</div>
        <a href="#" class="sidebar-link" data-view="payments">
          <span class="sidebar-link-icon"><i class="fa-solid fa-credit-card"></i></span>
          <span data-i18n="admin.nav.payments">Pagamentos</span>
          <span class="sidebar-link-badge badge-warning" id="badge-payments">0</span>
        </a>
        <a href="#" class="sidebar-link" data-view="invoices">
          <span class="sidebar-link-icon"><i class="fa-solid fa-file-invoice"></i></span>
          <span data-i18n="admin.nav.invoices">Faturas</span>
        </a>
      </div>

      <!-- Sistema -->
      <div class="sidebar-section">
        <div class="sidebar-section-title" data-i18n="admin.section.system">Sistema</div>
        <a href="#" class="sidebar-link" data-view="alerts">
          <span class="sidebar-link-icon"><i class="fa-solid fa-bell"></i></span>
          <span data-i18n="admin.nav.alerts">Alertas</span>
          <span class="sidebar-link-badge" id="badge-alerts">0</span>
        </a>
        <a href="#" class="sidebar-link" data-view="logs">
          <span class="sidebar-link-icon"><i class="fa-solid fa-scroll"></i></span>
          <span data-i18n="admin.nav.auditLogs">Audit Logs</span>
        </a>
        <a href="#" class="sidebar-link" data-view="settings">
          <span class="sidebar-link-icon"><i class="fa-solid fa-gear"></i></span>
          <span data-i18n="admin.nav.settings">Configurações</span>
        </a>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="sidebar-user-avatar" id="user-avatar">A</div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name" id="user-name">Admin</div>
          <div class="sidebar-user-role" id="user-role">Super Admin</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- ============ MAIN CONTENT ============ -->
  <main class="admin-main">
    <!-- Top Bar -->
    <header class="admin-topbar">
      <div class="topbar-left">
        <button class="btn-menu-toggle" id="btn-menu-toggle">☰</button>
        <div class="topbar-breadcrumb">
          <span data-i18n="admin.breadcrumb">Admin /</span> <span id="breadcrumb-current">Dashboard</span>
        </div>
      </div>
      <div class="topbar-right">
        <div class="lang-toggle">
          <button class="lang-btn" data-lang="pt">PT</button>
          <button class="lang-btn" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="es">ES</button>
        </div>
        <div class="topbar-search">
          <input type="text" data-i18n-placeholder="common.search" placeholder="Pesquisar..." id="global-search" />
        </div>
        <button class="topbar-btn" id="btn-notifications" title="Notificações">
          <i class="fa-solid fa-bell"></i>
          <span class="badge" id="notification-count">3</span>
        </button>
        <button class="topbar-btn" id="btn-help" title="Ajuda"><i class="fa-solid fa-circle-question"></i></button>
        <button class="btn-logout" id="btn-logout" data-i18n="common.logout">Terminar sessão</button>
      </div>
    </header>

    <!-- Content Area -->
    <div class="admin-content">
      
      <!-- ============ DASHBOARD VIEW ============ -->
      <div class="view-panel active" id="view-dashboard">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.dash.eyebrow">Visão Geral</div>
          <h1 class="page-title" data-i18n="admin.dash.title">Dashboard Global</h1>
          <p class="page-subtitle" data-i18n="admin.dash.desc">Monitorize todas as operações, clientes e métricas da plataforma GeoVision em tempo real.</p>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
          <button class="quick-action" onclick="showModal('modal-new-client')">
            <span><i class="fa-solid fa-plus"></i></span> <span data-i18n="admin.action.newClient">Novo Cliente</span>
          </button>
          <button class="quick-action" onclick="showModal('modal-new-site')">
            <span><i class="fa-solid fa-location-dot"></i></span> <span data-i18n="admin.action.newSite">Novo Site</span>
          </button>
          <button class="quick-action" onclick="showModal('modal-upload-doc')">
            <span><i class="fa-solid fa-upload"></i></span> <span data-i18n="admin.action.uploadDoc">Upload Documento</span>
          </button>
          <button class="quick-action" onclick="exportReport()">
            <span><i class="fa-solid fa-chart-column"></i></span> <span data-i18n="admin.action.exportReport">Exportar Relatório</span>
          </button>
        </div>

        <!-- KPI Grid -->
        <div class="kpi-grid">
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.clients">Total Clientes</span>
              <span class="kpi-icon"><i class="fa-solid fa-building"></i></span>
            </div>
            <div class="kpi-value" id="kpi-total-clients">0</div>
            <div class="kpi-change" data-i18n="admin.kpi.change.clients">+12% este mês</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.sites">Sites Ativos</span>
              <span class="kpi-icon"><i class="fa-solid fa-location-dot"></i></span>
            </div>
            <div class="kpi-value" id="kpi-total-sites">0</div>
            <div class="kpi-change" data-i18n="admin.kpi.change.sites">+8% este mês</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.datasets">Datasets</span>
              <span class="kpi-icon"><i class="fa-solid fa-database"></i></span>
            </div>
            <div class="kpi-value" id="kpi-total-datasets">0</div>
            <div class="kpi-change" data-i18n="admin.kpi.change.datasets">+15% este mês</div>
          </div>
          <div class="kpi-card revenue">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.revenue">Receita Mensal</span>
              <span class="kpi-icon"><i class="fa-solid fa-dollar-sign"></i></span>
            </div>
            <div class="kpi-value" id="kpi-revenue">0 AOA</div>
            <div class="kpi-change" data-i18n="admin.kpi.change.revenue">+22% vs mês anterior</div>
          </div>
          <div class="kpi-card warning">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.pendingPayments">Pagamentos Pendentes</span>
              <span class="kpi-icon"><i class="fa-solid fa-hourglass-half"></i></span>
            </div>
            <div class="kpi-value" id="kpi-pending-payments">0</div>
            <div class="kpi-change negative" data-i18n="admin.kpi.change.pending">Requerem atenção</div>
          </div>
          <div class="kpi-card danger">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.criticalAlerts">Alertas Críticos</span>
              <span class="kpi-icon"><i class="fa-solid fa-circle-exclamation"></i></span>
            </div>
            <div class="kpi-value" id="kpi-critical-alerts">0</div>
            <div class="kpi-change negative" data-i18n="admin.kpi.change.immediate">Ação imediata</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.contracts">Contratos Ativos</span>
              <span class="kpi-icon"><i class="fa-solid fa-clipboard"></i></span>
            </div>
            <div class="kpi-value" id="kpi-contracts">0</div>
            <div class="kpi-change" data-i18n="admin.kpi.change.stable">Estável</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label" data-i18n="admin.kpi.storage">Armazenamento</span>
              <span class="kpi-icon"><i class="fa-solid fa-hard-drive"></i></span>
            </div>
            <div class="kpi-value" id="kpi-storage">0 GB</div>
            <div class="kpi-change" data-i18n="admin.kpi.change.storage">De 1 TB</div>
          </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-i18n="admin.chart.growth">Crescimento Mensal</h3>
              <div class="card-actions">
                <button class="btn btn-sm btn-secondary">6M</button>
                <button class="btn btn-sm btn-secondary">1A</button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart-container" id="chart-growth">
                <p style="text-align:center;color:var(--text-muted);padding:2rem 0;"><i class="fa-solid fa-chart-line"></i> Sem dados de crescimento disponíveis.</p>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-i18n="admin.chart.revenue">Receita por Setor</h3>
            </div>
            <div class="card-body">
              <div class="chart-container" id="chart-revenue-sector">
                <p style="text-align:center;color:var(--text-muted);padding:2rem 0;"><i class="fa-solid fa-chart-pie"></i> Sem dados de receita disponíveis.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.activity.title">Atividade Recente</h3>
            <div class="card-actions">
              <button class="btn btn-sm btn-secondary" data-i18n="admin.activity.viewAll">Ver todos</button>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="admin.activity.time">Hora</th>
                  <th data-i18n="admin.activity.user">Utilizador</th>
                  <th data-i18n="admin.activity.action">Ação</th>
                  <th data-i18n="admin.activity.resource">Recurso</th>
                  <th data-i18n="admin.activity.details">Detalhes</th>
                </tr>
              </thead>
              <tbody id="activity-table-body">
                <!-- Activity rows populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ CLIENTS VIEW ============ -->
      <div class="view-panel" id="view-clients">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.clients.eyebrow">Gestão de Clientes</div>
          <h1 class="page-title" data-i18n="admin.clients.title">Clientes</h1>
          <p class="page-subtitle" data-i18n="admin.clients.desc">Gerir contas de clientes, planos e acessos.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-new-client')">
            <span><i class="fa-solid fa-plus"></i></span> <span data-i18n="admin.action.newClient">Novo Cliente</span>
          </button>
          <button class="btn btn-secondary">
            <span><i class="fa-solid fa-download"></i></span> <span data-i18n="admin.clients.import">Importar</span>
          </button>
          <button class="btn btn-secondary">
            <span><i class="fa-solid fa-upload"></i></span> <span data-i18n="admin.clients.export">Exportar</span>
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.clients.list">Lista de Clientes</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="" data-i18n="admin.clients.allStatus">Todos os status</option>
                <option value="active" data-i18n="admin.clients.active">Ativos</option>
                <option value="trial" data-i18n="admin.clients.trial">Trial</option>
                <option value="suspended" data-i18n="admin.clients.suspended">Suspensos</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="admin.clients.company">Empresa</th>
                  <th data-i18n="common.email">Email</th>
                  <th data-i18n="admin.clients.plan">Plano</th>
                  <th data-i18n="common.status">Status</th>
                  <th data-i18n="admin.nav.sites">Sites</th>
                  <th data-i18n="admin.clients.contact">Contacto</th>
                  <th data-i18n="common.actions">Ações</th>
                </tr>
              </thead>
              <tbody id="clients-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ DOCUMENTS VIEW ============ -->
      <div class="view-panel" id="view-documents">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.docs.eyebrow">Gestão de Documentos</div>
          <h1 class="page-title" data-i18n="admin.docs.title">Documentos</h1>
          <p class="page-subtitle" data-i18n="admin.docs.desc">Upload, organização e controlo de acesso a documentos de clientes.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-upload-doc')">
            <span><i class="fa-solid fa-upload"></i></span> <span data-i18n="admin.action.uploadDoc">Upload Documento</span>
          </button>
          <button class="btn btn-secondary">
            <span><i class="fa-solid fa-magnifying-glass"></i></span> <span data-i18n="admin.docs.advSearch">Pesquisa Avançada</span>
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.docs.recent">Documentos Recentes</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="" data-i18n="admin.docs.allTypes">Todos os tipos</option>
                <option value="report" data-i18n="admin.docs.reports">Relatórios</option>
                <option value="orthomosaic" data-i18n="admin.docs.ortho">Ortomosaicos</option>
                <option value="contract" data-i18n="admin.docs.contracts">Contratos</option>
                <option value="geotiff">GeoTIFF</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="common.name">Nome</th>
                  <th data-i18n="admin.docs.client">Cliente</th>
                  <th data-i18n="admin.docs.site">Site</th>
                  <th data-i18n="common.type">Tipo</th>
                  <th data-i18n="admin.docs.size">Tamanho</th>
                  <th data-i18n="common.status">Status</th>
                  <th data-i18n="common.date">Data</th>
                  <th data-i18n="common.actions">Ações</th>
                </tr>
              </thead>
              <tbody id="documents-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ INTEGRATIONS VIEW ============ -->
      <div class="view-panel" id="view-integrations">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.integrations.eyebrow">Integrações</div>
          <h1 class="page-title" data-i18n="admin.integrations.title">Softwares Externos</h1>
          <p class="page-subtitle" data-i18n="admin.integrations.desc">Gerir conexões com DJI Terra, Pix4D, ArcGIS, Procore e outros.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-new-connector')">
            <span><i class="fa-solid fa-link"></i></span> <span data-i18n="admin.integrations.new">Nova Integração</span>
          </button>
        </div>

        <div class="kpi-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">DJI Terra</span>
              <span class="kpi-icon"><i class="fa-solid fa-satellite"></i></span>
            </div>
            <div class="kpi-value">3</div>
            <div class="kpi-change" data-i18n="admin.integrations.activeConns">Conexões ativas</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Pix4D</span>
              <span class="kpi-icon"><i class="fa-solid fa-camera"></i></span>
            </div>
            <div class="kpi-value">5</div>
            <div class="kpi-change" data-i18n="admin.integrations.activeConns">Conexões ativas</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">ArcGIS</span>
              <span class="kpi-icon"><i class="fa-solid fa-map-location-dot"></i></span>
            </div>
            <div class="kpi-value">2</div>
            <div class="kpi-change" data-i18n="admin.integrations.activeConns">Conexões ativas</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <span class="kpi-label">Procore</span>
              <span class="kpi-icon"><i class="fa-solid fa-helmet-safety"></i></span>
            </div>
            <div class="kpi-value">1</div>
            <div class="kpi-change" data-i18n="admin.integrations.activeConns">Conexões ativas</div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.integrations.configured">Integrações Configuradas</h3>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="admin.docs.client">Cliente</th>
                  <th data-i18n="admin.integrations.software">Software</th>
                  <th data-i18n="common.name">Nome</th>
                  <th data-i18n="common.status">Status</th>
                  <th data-i18n="admin.integrations.lastSync">Última Sync</th>
                  <th data-i18n="admin.integrations.autoSync">Auto-Sync</th>
                  <th data-i18n="common.actions">Ações</th>
                </tr>
              </thead>
              <tbody id="integrations-table-body">
                <!-- Populated by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ============ SETTINGS VIEW ============ -->
      <div class="view-panel" id="view-settings">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.settings.eyebrow">Sistema</div>
          <h1 class="page-title" data-i18n="admin.settings.title">Configurações</h1>
          <p class="page-subtitle" data-i18n="admin.settings.desc">Configurações gerais da plataforma, segurança e integrações.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.settings.contacts">Contactos GeoVision</h3>
          </div>
          <div class="card-body">
            <div class="contact-buttons" style="margin-bottom: 1rem;">
              <a href="https://wa.me/244928917269" target="_blank" class="contact-btn whatsapp">
                <i class="fa-solid fa-mobile-screen-button"></i> <span data-i18n="admin.settings.whatsapp">WhatsApp</span>
              </a>
              <a href="mailto:suporte@geovisionops.com" class="contact-btn email">
                <i class="fa-solid fa-envelope"></i> <span data-i18n="admin.settings.email">Email</span>
              </a>
              <a href="tel:+244928917269" class="contact-btn phone">
                <i class="fa-solid fa-phone"></i> <span data-i18n="admin.settings.call">Ligar</span>
              </a>
              <a href="sms:+244928917269" class="contact-btn phone">
                <i class="fa-solid fa-comments"></i> <span data-i18n="admin.settings.sms">SMS</span>
              </a>
              <a href="https://instagram.com/Geovision.operations" target="_blank" class="contact-btn instagram">
                <i class="fa-brands fa-instagram"></i> <span data-i18n="admin.settings.instagram">Instagram</span>
              </a>
            </div>
            <p style="font-size: 0.85rem; color: #9ca3af;" data-i18n="admin.settings.contactsDesc">
              Estes contactos são usados para comunicação directa com clientes e suporte.
            </p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.settings.roles">Roles e Permissões</h3>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="admin.roles.role">Role</th>
                  <th data-i18n="admin.roles.description">Descrição</th>
                  <th data-i18n="admin.roles.users">Utilizadores</th>
                  <th data-i18n="admin.roles.level">Nível</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><span class="badge badge-active">Super Admin</span></td>
                  <td data-i18n="admin.roles.desc.superadmin">Acesso total à plataforma</td>
                  <td>2</td>
                  <td data-i18n="admin.roles.level.internal">Interno GeoVision</td>
                </tr>
                <tr>
                  <td><span class="badge badge-trial">Admin</span></td>
                  <td data-i18n="admin.roles.desc.admin">Funções administrativas</td>
                  <td>3</td>
                  <td data-i18n="admin.roles.level.internal">Interno GeoVision</td>
                </tr>
                <tr>
                  <td><span class="badge badge-pending">Manager</span></td>
                  <td data-i18n="admin.roles.desc.manager">Operações diárias</td>
                  <td>5</td>
                  <td data-i18n="admin.roles.level.internal">Interno GeoVision</td>
                </tr>
                <tr>
                  <td><span class="badge badge-active">Client Admin</span></td>
                  <td data-i18n="admin.roles.desc.clientAdmin">Admin da organização cliente</td>
                  <td>15</td>
                  <td data-i18n="admin.roles.level.client">Cliente</td>
                </tr>
                <tr>
                  <td><span class="badge badge-trial">Client Viewer</span></td>
                  <td data-i18n="admin.roles.desc.clientViewer">Apenas leitura</td>
                  <td>45</td>
                  <td data-i18n="admin.roles.level.client">Cliente</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Placeholder for other views -->
      <div class="view-panel" id="view-users">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.section.management">Gestão</div>
          <h1 class="page-title" data-i18n="admin.nav.users">Utilizadores</h1>
        </div>
        <div class="card"><div class="card-body" data-i18n="admin.inDev">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-sites">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.section.management">Gestão</div>
          <h1 class="page-title" data-i18n="admin.sites.title">Sites / Projetos</h1>
          <p class="page-subtitle" data-i18n="admin.sites.desc">Gerir localizações e projetos de clientes.</p>
        </div>

        <div class="quick-actions">
          <button class="btn btn-primary" onclick="showModal('modal-new-site')">
            <span><i class="fa-solid fa-plus"></i></span> <span data-i18n="admin.action.newSite">Novo Site</span>
          </button>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.sites.list">Lista de Sites</h3>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="common.name">Nome</th>
                  <th data-i18n="admin.docs.client">Cliente</th>
                  <th data-i18n="admin.sites.province">Província</th>
                  <th data-i18n="admin.sites.sector">Setor</th>
                  <th data-i18n="admin.sites.area">Área</th>
                  <th data-i18n="common.status">Status</th>
                  <th data-i18n="common.actions">Ações</th>
                </tr>
              </thead>
              <tbody id="sites-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="view-panel" id="view-datasets">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.section.management">Gestão</div>
          <h1 class="page-title" data-i18n="admin.datasets.title">Datasets</h1>
          <p class="page-subtitle" data-i18n="admin.datasets.desc">Dados de drones, satélite e sensores dos projetos.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.datasets.list">Lista de Datasets</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="" data-i18n="admin.datasets.allTypes">Todos os tipos</option>
                <option value="drone_imagery" data-i18n="admin.datasets.drone">Drone Imagery</option>
                <option value="satellite" data-i18n="admin.datasets.satellite">Satélite</option>
                <option value="lidar" data-i18n="admin.datasets.lidar">LiDAR</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="common.name">Nome</th>
                  <th data-i18n="admin.docs.client">Cliente</th>
                  <th data-i18n="admin.docs.site">Site</th>
                  <th data-i18n="common.type">Tipo</th>
                  <th data-i18n="admin.docs.size">Tamanho</th>
                  <th data-i18n="common.status">Status</th>
                  <th data-i18n="common.date">Data</th>
                  <th data-i18n="common.actions">Ações</th>
                </tr>
              </thead>
              <tbody id="datasets-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="view-panel" id="view-payments">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.section.financial">Financeiro</div>
          <h1 class="page-title" data-i18n="admin.nav.payments">Pagamentos</h1>
        </div>
        <div class="card"><div class="card-body" data-i18n="admin.inDev">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-invoices">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.section.financial">Financeiro</div>
          <h1 class="page-title" data-i18n="admin.nav.invoices">Faturas</h1>
        </div>
        <div class="card"><div class="card-body" data-i18n="admin.inDev">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-alerts">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.section.system">Sistema</div>
          <h1 class="page-title" data-i18n="admin.nav.alerts">Alertas</h1>
        </div>
        <div class="card"><div class="card-body" data-i18n="admin.inDev">Em desenvolvimento...</div></div>
      </div>

      <div class="view-panel" id="view-logs">
        <div class="page-header">
          <div class="page-eyebrow" data-i18n="admin.section.system">Sistema</div>
          <h1 class="page-title" data-i18n="admin.logs.pageTitle">Audit Logs</h1>
          <p class="page-subtitle" data-i18n="admin.logs.desc">Histórico de ações e alterações na plataforma.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="admin.logs.title">Logs de Auditoria</h3>
            <div class="card-actions">
              <select class="form-select" style="width: auto; padding: 0.4rem 0.7rem; font-size: 0.8rem;">
                <option value="" data-i18n="admin.logs.allActions">Todas as ações</option>
                <option value="company_created" data-i18n="admin.logs.companyCreated">Empresa criada</option>
                <option value="site_created" data-i18n="admin.logs.siteCreated">Site criado</option>
                <option value="document_created" data-i18n="admin.logs.docCreated">Documento criado</option>
                <option value="login" data-i18n="admin.logs.login">Login</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <table class="data-table">
              <thead>
                <tr>
                  <th data-i18n="admin.logs.dateTime">Data/Hora</th>
                  <th data-i18n="admin.logs.user">Utilizador</th>
                  <th data-i18n="admin.logs.action">Ação</th>
                  <th data-i18n="admin.logs.resource">Recurso</th>
                  <th data-i18n="admin.logs.id">ID</th>
                  <th data-i18n="admin.logs.ip">IP</th>
                </tr>
              </thead>
              <tbody id="audit-logs-table-body"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- ============ MODALS ============ -->
  
  <!-- New Client Modal -->
  <div class="modal-overlay" id="modal-new-client">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" data-i18n="admin.action.newClient">Novo Cliente</h2>
        <button class="modal-close" onclick="closeModal('modal-new-client')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-new-client">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.companyName">Nome da Empresa *</label>
              <input type="text" class="form-input" name="name" required />
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.nif">NIF</label>
              <input type="text" class="form-input" name="tax_id" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.email">Email *</label>
              <input type="email" class="form-input" name="email" required />
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.phone">Telefone</label>
              <input type="tel" class="form-input" name="phone" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.whatsapp">WhatsApp</label>
              <input type="tel" class="form-input" name="whatsapp" placeholder="+244..." />
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.plan">Plano</label>
              <select class="form-select" name="subscription_plan">
                <option value="trial" data-i18n="admin.modal.planTrial">Trial (14 dias)</option>
                <option value="starter" data-i18n="admin.modal.planStarter">Starter</option>
                <option value="professional" data-i18n="admin.modal.planPro">Professional</option>
                <option value="enterprise" data-i18n="admin.modal.planEnterprise">Enterprise</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="admin.modal.sectors">Setores</label>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="agro" /> <span data-i18n="admin.modal.sectorAgro">Agro & Pecuária</span></label>
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="mining" /> <span data-i18n="admin.modal.sectorMining">Mineração</span></label>
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="demining" /> <span data-i18n="admin.modal.sectorDemining">Desminagem</span></label>
              <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="construction" /> <span data-i18n="admin.modal.sectorConstruction">Construção</span></label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="admin.modal.address">Morada</label>
            <textarea class="form-textarea" name="address" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('modal-new-client')" data-i18n="common.cancel">Cancelar</button>
        <button class="btn btn-primary" onclick="saveNewClient()" data-i18n="admin.modal.createClient">Criar Cliente</button>
      </div>
    </div>
  </div>

  <!-- Edit Client Modal -->
  <div class="modal-overlay" id="modal-edit-client">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" data-i18n="admin.action.editClient">Editar Cliente</h2>
        <button class="modal-close" onclick="closeModal('modal-edit-client')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-edit-client">
          <input type="hidden" name="id" />
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.companyName">Nome da Empresa *</label>
              <input type="text" class="form-input" name="name" required />
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.nif">NIF</label>
              <input type="text" class="form-input" name="tax_id" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.email">Email *</label>
              <input type="email" class="form-input" name="email" required />
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.phone">Telefone</label>
              <input type="tel" class="form-input" name="phone" />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.whatsapp">WhatsApp</label>
              <input type="tel" class="form-input" name="whatsapp" placeholder="+244..." />
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.plan">Plano</label>
              <select class="form-select" name="subscription_plan">
                <option value="trial" data-i18n="admin.modal.planTrial">Trial (14 dias)</option>
                <option value="starter" data-i18n="admin.modal.planStarter">Starter</option>
                <option value="professional" data-i18n="admin.modal.planPro">Professional</option>
                <option value="enterprise" data-i18n="admin.modal.planEnterprise">Enterprise</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Status</label>
              <select class="form-select" name="status">
                <option value="active">Ativo</option>
                <option value="suspended">Suspenso</option>
                <option value="cancelled">Cancelado</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.modal.sectors">Setores</label>
              <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="agro" /> <span data-i18n="admin.modal.sectorAgro">Agro & Pecuaria</span></label>
                <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="mining" /> <span data-i18n="admin.modal.sectorMining">Mineracao</span></label>
                <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="demining" /> <span data-i18n="admin.modal.sectorDemining">Desminagem</span></label>
                <label style="font-size: 0.85rem;"><input type="checkbox" name="sectors" value="construction" /> <span data-i18n="admin.modal.sectorConstruction">Construcao</span></label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="admin.modal.address">Morada</label>
            <textarea class="form-textarea" name="address" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('modal-edit-client')" data-i18n="common.cancel">Cancelar</button>
        <button class="btn btn-primary" onclick="saveEditClient()" data-i18n="admin.action.saveClient">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Upload Document Modal -->
  <div class="modal-overlay" id="modal-upload-doc">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" data-i18n="admin.action.uploadDoc">Upload Documento</h2>
        <button class="modal-close" onclick="closeModal('modal-upload-doc')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-upload-doc">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.upload.client">Cliente *</label>
              <select class="form-select" name="company_id" required>
                <option value="" data-i18n="admin.upload.selectClient">Selecionar cliente...</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.upload.site">Site</label>
              <select class="form-select" name="site_id">
                <option value="" data-i18n="admin.upload.selectSite">Selecionar site...</option>
              </select>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" data-i18n="admin.upload.docType">Tipo de Documento *</label>
              <select class="form-select" name="document_type" required>
                <option value="report" data-i18n="admin.upload.report">Relatório</option>
                <option value="orthomosaic" data-i18n="admin.upload.ortho">Ortomosaico</option>
                <option value="contract" data-i18n="admin.upload.contract">Contrato</option>
                <option value="invoice" data-i18n="admin.upload.invoice">Fatura</option>
                <option value="geotiff">GeoTIFF</option>
                <option value="point_cloud" data-i18n="admin.upload.pointCloud">Point Cloud (LAS/LAZ)</option>
                <option value="shapefile" data-i18n="admin.upload.shapefile">Shapefile</option>
                <option value="dxf">DXF</option>
                <option value="other" data-i18n="admin.upload.other">Outro</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" data-i18n="admin.upload.status">Status</label>
              <select class="form-select" name="status">
                <option value="draft" data-i18n="admin.upload.draft">Rascunho</option>
                <option value="pending_review" data-i18n="admin.upload.pendingReview">Pendente Revisão</option>
                <option value="approved" data-i18n="admin.upload.approved">Aprovado</option>
                <option value="official" data-i18n="admin.upload.official">Oficial</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="admin.upload.docName">Nome do Documento *</label>
            <input type="text" class="form-input" name="name" required />
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="admin.upload.file">Ficheiro *</label>
            <input type="file" class="form-input" name="file" required 
                   accept=".pdf,.docx,.doc,.tif,.tiff,.las,.laz,.shp,.csv,.dxf,.png,.jpg,.jpeg" />
            <p style="font-size: 0.75rem; color: #6b7280; margin-top: 0.3rem;" data-i18n="admin.upload.formats">
              Formatos: PDF, DOCX, GeoTIFF, LAS/LAZ, SHP, CSV, DXF, Imagens
            </p>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label style="font-size: 0.85rem;">
                <input type="checkbox" name="is_confidential" /> <span data-i18n="admin.upload.confidential">Confidencial</span>
              </label>
            </div>
            <div class="form-group">
              <label style="font-size: 0.85rem;">
                <input type="checkbox" name="is_official" /> <span data-i18n="admin.upload.markOfficial">Marcar como Oficial</span>
              </label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label" data-i18n="admin.upload.description">Descrição</label>
            <textarea class="form-textarea" name="description" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('modal-upload-doc')" data-i18n="common.cancel">Cancelar</button>
        <button class="btn btn-primary" onclick="uploadDocument()" data-i18n="admin.upload.submit">Upload</button>
      </div>
    </div>
  </div>

  <script src="assets/js/i18n.js?v=1"></script>
  <script src="assets/js/config.js?v=5"></script>
  <script>
    // ============ VIEW NAVIGATION ============
    const viewLinks = document.querySelectorAll('.sidebar-link[data-view]');
    const viewPanels = document.querySelectorAll('.view-panel');
    const breadcrumb = document.getElementById('breadcrumb-current');

    function switchView(viewId) {
      // Update sidebar
      viewLinks.forEach(link => {
        link.classList.toggle('active', link.dataset.view === viewId);
      });

      // Update panels
      viewPanels.forEach(panel => {
        panel.classList.toggle('active', panel.id === `view-${viewId}`);
      });

      // Update breadcrumb
      const activeLink = document.querySelector(`.sidebar-link[data-view="${viewId}"]`);
      if (activeLink) {
        breadcrumb.textContent = activeLink.textContent.trim();
      }
    }

    viewLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        switchView(link.dataset.view);
      });
    });

    // ============ SIDEBAR TOGGLE ============
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('btn-menu-toggle');

    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      if (window.innerWidth <= 1024) {
        if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
          sidebar.classList.remove('open');
        }
      }
    });

    // ============ MODALS ============
    function showModal(modalId) {
      // Populate client dropdown in upload modal
      if (modalId === 'modal-upload-doc') {
        const sel = document.querySelector('#form-upload-doc select[name="company_id"]');
        if (sel) {
          const current = sel.value;
          sel.innerHTML = '<option value="">Selecionar cliente...</option>' +
            _cachedCompanies.map(c => `<option value="${c.id}">${c.name} (${c.email})</option>`).join('');
          if (current) sel.value = current;
          // Load sites when client changes
          sel.onchange = function() {
            const siteSel = document.querySelector('#form-upload-doc select[name="site_id"]');
            siteSel.innerHTML = '<option value="">Selecionar site...</option>';
            if (!this.value) return;
            fetch(`${API_BASE}/admin/companies/${this.value}/sites`, { headers: authHeaders() })
              .then(r => r.ok ? r.json() : [])
              .then(sites => {
                siteSel.innerHTML = '<option value="">Selecionar site...</option>' +
                  sites.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
              })
              .catch(() => {});
          };
        }
      }
      document.getElementById(modalId).classList.add('open');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('open');
    }

    // Close modal on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('open');
        }
      });
    });

    // ============ API CALLS ============
    const API_BASE = window.API_BASE || 'http://127.0.0.1:8010';

    function authHeaders(extra = {}) {
      const token = localStorage.getItem('gv_token');
      const h = { ...extra };
      if (token) h['Authorization'] = 'Bearer ' + token;
      return h;
    }

    async function loadDashboardData() {
      try {
        const response = await fetch(`${API_BASE}/admin/stats`, { headers: authHeaders() });
        if (response.ok) {
          const stats = await response.json();
          document.getElementById('kpi-total-clients').textContent = stats.total_companies || 0;
          document.getElementById('kpi-total-sites').textContent = stats.total_sites || 0;
          document.getElementById('kpi-total-datasets').textContent = stats.total_datasets || 0;
          document.getElementById('kpi-pending-payments').textContent = stats.payments_pending || 0;
          document.getElementById('badge-clients').textContent = stats.total_companies || 0;
          document.getElementById('badge-payments').textContent = stats.payments_pending || 0;
        }
      } catch (err) {
        console.warn('Could not load admin stats:', err);
      }
    }

    let _cachedCompanies = [];

    async function loadClients() {
      try {
        const response = await fetch(`${API_BASE}/admin/companies`, { headers: authHeaders() });
        if (response.ok) {
          const companies = await response.json();
          _cachedCompanies = companies;
          // Update badge count
          const badge = document.getElementById('badge-clients');
          if (badge) badge.textContent = companies.length;
          const kpi = document.getElementById('kpi-total-clients');
          if (kpi) kpi.textContent = companies.length;

          const tbody = document.getElementById('clients-table-body');
          tbody.innerHTML = companies.map(c => `
            <tr>
              <td><strong>${c.name}</strong></td>
              <td>${c.email}</td>
              <td><span class="badge badge-trial">${c.subscription_plan}</span></td>
              <td><span class="badge badge-${c.status}">${c.status}</span></td>
              <td>${c.current_sites} / ${c.max_sites}</td>
              <td>
                <div class="contact-buttons">
                  ${c.phone ? `<a href="https://wa.me/${c.phone.replace(/[^0-9]/g, '')}" target="_blank" class="contact-btn whatsapp"><i class="fa-solid fa-mobile-screen-button"></i></a>` : ''}
                  <a href="mailto:${c.email}" class="contact-btn email"><i class="fa-solid fa-envelope"></i></a>
                </div>
              </td>
              <td>
                <button class="btn btn-sm btn-secondary" onclick="editClient('${c.id}')">Editar</button>
                <button class="btn btn-sm btn-danger" onclick="suspendClient('${c.id}')">Suspender</button>
              </td>
            </tr>
          `).join('');
        }
      } catch (err) {
        console.warn('Could not load clients:', err);
      }
    }

    async function saveNewClient() {
      const form = document.getElementById('form-new-client');
      const formData = new FormData(form);
      
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        tax_id: formData.get('tax_id'),
        address: formData.get('address'),
        subscription_plan: formData.get('subscription_plan'),
        sectors: formData.getAll('sectors'),
      };

      try {
        const response = await fetch(`${API_BASE}/admin/companies`, {
          method: 'POST',
          headers: authHeaders({ 'Content-Type': 'application/json' }),
          body: JSON.stringify(data),
        });

        if (response.ok) {
          closeModal('modal-new-client');
          form.reset();
          loadClients();
          loadDashboardData();
          alert('Cliente criado com sucesso!');
        } else {
          const err = await response.json();
          alert('Erro: ' + (err.detail || 'Não foi possível criar'));
        }
      } catch (err) {
        alert('Erro de conexão: ' + err.message);
      }
    }

    function editClient(clientId) {
      const c = _cachedCompanies.find(x => x.id === clientId);
      if (!c) { alert('Cliente nao encontrado'); return; }
      const form = document.getElementById('form-edit-client');
      form.querySelector('[name="id"]').value = c.id;
      form.querySelector('[name="name"]').value = c.name || '';
      form.querySelector('[name="tax_id"]').value = c.tax_id || '';
      form.querySelector('[name="email"]').value = c.email || '';
      form.querySelector('[name="phone"]').value = c.phone || '';
      form.querySelector('[name="whatsapp"]').value = c.whatsapp || '';
      form.querySelector('[name="subscription_plan"]').value = c.subscription_plan || 'trial';
      form.querySelector('[name="status"]').value = c.status || 'active';
      form.querySelector('[name="address"]').value = c.address || '';
      // Set sector checkboxes
      form.querySelectorAll('[name="sectors"]').forEach(cb => {
        cb.checked = (c.sectors || []).includes(cb.value);
      });
      showModal('modal-edit-client');
    }

    async function saveEditClient() {
      const form = document.getElementById('form-edit-client');
      const formData = new FormData(form);
      const clientId = formData.get('id');
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        phone: formData.get('phone') || null,
        tax_id: formData.get('tax_id') || null,
        address: formData.get('address') || null,
        subscription_plan: formData.get('subscription_plan'),
        status: formData.get('status'),
        sectors: formData.getAll('sectors'),
      };
      try {
        const response = await fetch(`${API_BASE}/admin/companies/${clientId}`, {
          method: 'PATCH',
          headers: authHeaders({ 'Content-Type': 'application/json' }),
          body: JSON.stringify(data),
        });
        if (response.ok) {
          closeModal('modal-edit-client');
          loadClients();
          loadDashboardData();
          alert('Cliente atualizado com sucesso!');
        } else {
          const err = await response.json();
          alert('Erro: ' + (err.detail || 'Nao foi possivel atualizar'));
        }
      } catch (err) {
        alert('Erro de conexao: ' + err.message);
      }
    }

    async function suspendClient(clientId) {
      if (!confirm('Tem certeza que deseja suspender este cliente?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/admin/companies/${clientId}`, {
          method: 'DELETE',
          headers: authHeaders(),
        });
        if (response.ok) {
          loadClients();
          loadDashboardData();
        }
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    function uploadDocument() {
      const form = document.getElementById('form-upload-doc');
      const formData = new FormData(form);
      const companyId = formData.get('company_id');
      if (!companyId) { alert('Selecione um cliente.'); return; }
      const name = formData.get('name');
      if (!name) { alert('Insira o nome do documento.'); return; }
      const data = {
        name: name,
        document_type: formData.get('document_type') || 'report',
        description: formData.get('description') || '',
        is_confidential: form.querySelector('[name="is_confidential"]')?.checked || false,
        is_official: form.querySelector('[name="is_official"]')?.checked || false,
      };
      const siteId = formData.get('site_id');
      let url = `${API_BASE}/admin/companies/${companyId}/documents`;
      if (siteId) url += `?site_id=${siteId}`;
      fetch(url, {
        method: 'POST',
        headers: authHeaders({ 'Content-Type': 'application/json' }),
        body: JSON.stringify(data),
      })
      .then(async r => {
        if (r.ok) {
          closeModal('modal-upload-doc');
          form.reset();
          loadDocuments();
          alert('Documento registado com sucesso!');
        } else {
          const err = await r.json();
          alert('Erro: ' + (err.detail || 'Falha ao registar documento'));
        }
      })
      .catch(err => alert('Erro de conexao: ' + err.message));
    }

    function exportReport() {
      // TODO: integrate report export endpoint
    }

    // ============ SITES ============
    async function loadSites() {
      try {
        const response = await fetch(`${API_BASE}/admin/sites`, { headers: authHeaders() });
        if (response.ok) {
          const sites = await response.json();
          const tbody = document.getElementById('sites-table-body');
          if (tbody) {
            tbody.innerHTML = sites.map(s => `
              <tr>
                <td><strong>${s.name}</strong></td>
                <td>${s.company_id.substring(0, 8)}...</td>
                <td>${s.province || '-'}</td>
                <td>${s.sector || '-'}</td>
                <td>${s.area_hectares ? s.area_hectares.toFixed(1) + ' ha' : '-'}</td>
                <td><span class="badge ${s.is_active ? 'badge-active' : 'badge-suspended'}">${s.is_active ? 'Ativo' : 'Inativo'}</span></td>
                <td>
                  <button class="btn btn-sm btn-secondary" onclick="viewSite('${s.id}')">Ver</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteSite('${s.id}')">Excluir</button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load sites:', err);
      }
    }

    async function deleteSite(siteId) {
      if (!confirm('Tem certeza que deseja excluir este site?')) return;
      try {
        await fetch(`${API_BASE}/admin/sites/${siteId}`, { method: 'DELETE', headers: authHeaders() });
        loadSites();
        loadDashboardData();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    function viewSite(siteId) {
      alert('Ver detalhes do site: ' + siteId);
    }

    // ============ DOCUMENTS ============
    async function loadDocuments() {
      try {
        const response = await fetch(`${API_BASE}/admin/documents`, { headers: authHeaders() });
        if (response.ok) {
          const docs = await response.json();
          const tbody = document.getElementById('documents-table-body');
          if (tbody) {
            tbody.innerHTML = docs.map(d => `
              <tr>
                <td><strong>${d.name}</strong></td>
                <td>${d.company_id.substring(0, 8)}...</td>
                <td>${d.site_id ? d.site_id.substring(0, 8) + '...' : '-'}</td>
                <td><span class="badge badge-trial">${d.document_type}</span></td>
                <td>${formatBytes(d.file_size_bytes)}</td>
                <td><span class="badge badge-${d.status === 'approved' ? 'active' : d.status === 'draft' ? 'pending' : 'trial'}">${d.status}</span></td>
                <td>${new Date(d.created_at).toLocaleDateString('pt-PT')}</td>
                <td>
                  <button class="btn btn-sm btn-secondary" onclick="downloadDocument('${d.id}')"><i class="fa-solid fa-download"></i></button>
                  <button class="btn btn-sm btn-danger" onclick="deleteDocument('${d.id}')"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load documents:', err);
      }
    }

    function formatBytes(bytes) {
      if (!bytes || bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    async function deleteDocument(docId) {
      if (!confirm('Tem certeza que deseja excluir este documento?')) return;
      try {
        await fetch(`${API_BASE}/admin/documents/${docId}`, { method: 'DELETE', headers: authHeaders() });
        loadDocuments();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    function downloadDocument(docId) {
      alert('Download do documento: ' + docId);
    }

    // ============ INTEGRATIONS ============
    async function loadIntegrations() {
      try {
        const response = await fetch(`${API_BASE}/admin/integrations`, { headers: authHeaders() });
        if (response.ok) {
          const integrations = await response.json();
          const tbody = document.getElementById('integrations-table-body');
          if (tbody) {
            tbody.innerHTML = integrations.map(i => `
              <tr>
                <td>${i.company_id.substring(0, 8)}...</td>
                <td><span class="badge badge-trial">${i.connector_type}</span></td>
                <td><strong>${i.name}</strong></td>
                <td><span class="badge ${i.is_active ? 'badge-active' : 'badge-suspended'}">${i.is_active ? 'Ativo' : 'Inativo'}</span></td>
                <td>${i.last_sync_at ? new Date(i.last_sync_at).toLocaleString('pt-PT') : 'Nunca'}</td>
                <td>${i.auto_sync_enabled ? '<i class="fa-solid fa-circle-check"></i>' : '<i class="fa-solid fa-circle-xmark"></i>'}</td>
                <td>
                  <button class="btn btn-sm btn-primary" onclick="syncIntegration('${i.id}')"><i class="fa-solid fa-rotate"></i> Sync</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteIntegration('${i.id}')"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load integrations:', err);
      }
    }

    async function syncIntegration(integrationId) {
      try {
        const response = await fetch(`${API_BASE}/admin/integrations/${integrationId}/sync`, { method: 'POST', headers: authHeaders() });
        if (response.ok) {
          alert('Sync iniciado!');
          loadIntegrations();
        }
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    async function deleteIntegration(integrationId) {
      if (!confirm('Tem certeza que deseja excluir esta integração?')) return;
      try {
        await fetch(`${API_BASE}/admin/integrations/${integrationId}`, { method: 'DELETE', headers: authHeaders() });
        loadIntegrations();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    // ============ DATASETS ============
    async function loadDatasets() {
      try {
        const response = await fetch(`${API_BASE}/admin/datasets`, { headers: authHeaders() });
        if (response.ok) {
          const datasets = await response.json();
          const tbody = document.getElementById('datasets-table-body');
          if (tbody) {
            tbody.innerHTML = datasets.map(d => `
              <tr>
                <td><strong>${d.name}</strong></td>
                <td>${d.company_id.substring(0, 8)}...</td>
                <td>${d.site_id.substring(0, 8)}...</td>
                <td><span class="badge badge-trial">${d.data_type}</span></td>
                <td>${formatBytes(d.size_bytes)}</td>
                <td><span class="badge badge-${d.status === 'processed' ? 'active' : 'pending'}">${d.status}</span></td>
                <td>${new Date(d.created_at).toLocaleDateString('pt-PT')}</td>
                <td>
                  <button class="btn btn-sm btn-danger" onclick="deleteDataset('${d.id}')"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load datasets:', err);
      }
    }

    async function deleteDataset(datasetId) {
      if (!confirm('Tem certeza que deseja excluir este dataset?')) return;
      try {
        await fetch(`${API_BASE}/admin/datasets/${datasetId}`, { method: 'DELETE', headers: authHeaders() });
        loadDatasets();
        loadDashboardData();
      } catch (err) {
        alert('Erro: ' + err.message);
      }
    }

    // ============ AUDIT LOGS ============
    async function loadAuditLogs() {
      try {
        const response = await fetch(`${API_BASE}/admin/audit-logs`, { headers: authHeaders() });
        if (response.ok) {
          const logs = await response.json();
          const tbody = document.getElementById('audit-logs-table-body');
          if (tbody) {
            tbody.innerHTML = logs.map(l => `
              <tr>
                <td>${new Date(l.created_at).toLocaleString('pt-PT')}</td>
                <td>${l.user_id || 'Sistema'}</td>
                <td><span class="badge badge-trial">${l.action}</span></td>
                <td>${l.resource_type}</td>
                <td>${l.resource_id ? l.resource_id.substring(0, 8) + '...' : '-'}</td>
                <td>${l.ip_address || '-'}</td>
              </tr>
            `).join('');
          }
        }
      } catch (err) {
        console.warn('Could not load audit logs:', err);
      }
    }

    // ============ VIEW CHANGE HANDLER ============
    function onViewChange(viewId) {
      switch (viewId) {
        case 'clients':
          loadClients();
          break;
        case 'sites':
          loadSites();
          break;
        case 'documents':
          loadDocuments();
          break;
        case 'integrations':
          loadIntegrations();
          break;
        case 'datasets':
          loadDatasets();
          break;
        case 'logs':
          loadAuditLogs();
          break;
      }
    }

    // Update switchView to call onViewChange
    const originalSwitchView = switchView;
    switchView = function(viewId) {
      originalSwitchView(viewId);
      onViewChange(viewId);
    };

    // ============ LOGOUT ============
    document.getElementById('btn-logout').addEventListener('click', () => {
      localStorage.removeItem('gv_token');
      localStorage.removeItem('gv_role');
      localStorage.removeItem('gv_email');
      localStorage.removeItem('gv_name');
      localStorage.removeItem('gv_user');
      localStorage.removeItem('gv_account_id');
      localStorage.removeItem('gv_account_name');
      localStorage.removeItem('gv_refresh_token');
      window.location.href = 'index.html';
    });

    // ============ INIT ============
    document.addEventListener('DOMContentLoaded', () => {
      // Auth guard — verify admin token
      const initToken = localStorage.getItem('gv_token');
      if (!initToken) {
        window.location.href = 'login.html';
        return;
      }
      fetch(API_BASE + '/auth/me', { headers: { Authorization: 'Bearer ' + initToken } })
        .then(r => { if (!r.ok) throw new Error('Auth failed'); return r.json(); })
        .then(me => {
          if (me.role !== 'admin') {
            alert('Acesso restrito. Inicie sessao como administrador.');
            window.location.href = 'login.html';
            return;
          }
          // Store fresh user data
          if (me.email) localStorage.setItem('gv_email', me.email);
          if (me.name) localStorage.setItem('gv_name', me.name);
          if (me.role) localStorage.setItem('gv_role', me.role);
          if (me.account_name) localStorage.setItem('gv_account_name', me.account_name);
          if (me.account_id) localStorage.setItem('gv_account_id', me.account_id);

          const displayName = me.name || (me.email ? me.email.split('@')[0] : 'Admin');
          document.getElementById('user-name').textContent = displayName;
          document.getElementById('user-role').textContent = 'Super Admin';
          document.getElementById('user-avatar').textContent = (displayName.charAt(0) || 'A').toUpperCase();

          // Load data after auth confirmed
          loadDashboardData();
          loadClients();
        })
        .catch(() => {
          alert('Sessao expirada. Faca login novamente.');
          localStorage.removeItem('gv_token');
          window.location.href = 'login.html';
        });
    });
  </script>
  <script>window.GV_CHAT_API_BASE = window.API_BASE;</script>
  <script src="assets/js/chatbot.js?v=4"></script>
  <script src="assets/js/contacts.js?v=1"></script>
</body>
</html>
